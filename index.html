<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Setting path fills dynamically to generate a choropleth</title>
		<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://d3js.org/d3-color.v1.min.js"></script>
        <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
        <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
		<style type="text/css">
            body{
                background-color: #163818;
            }		
            
            button {

                border: none;
                color: white;
                padding: 15px 32px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                font-weight: bold;
                margin: 4px 2px;
                cursor: pointer;
                top: 191px;
                left: 420px;
                background-color: #28682d;

            }
            
            h1{
                color: white;
            }

		</style>
	</head>
	<body>
        
        <h1>United States Agricultural Producitivity, 2016</h1>
        
        <div class = "button-container">    
            <button class="button toggleData">Toggle Data</button>    
        </div>   
		<script type="text/javascript">

			//Width and height
			var w = 800;
			var h = 400;

			//Define map projection
			var projection = d3.geoAlbersUsa()
								   .translate([w/2, h/2])
								   .scale([800]);

			//Define path generator
			var path = d3.geoPath()
							 .projection(projection);
							 
			//Define quantize scale to sort data values into buckets of color
			
            var colorPop = d3.scaleQuantile()
                .domain([1000000, 2500000, 7500000, 12500000, 35000000])
				.range(["#fcbba1","#fb6a4a","#de2d26","#ef3b2c","#a50f15"]);
			
            //var colorPop = d3.scaleSequential(d3.interpolateReds)
			
            console.log(colorPop(4863300))
            //var colorS = d3.scaleSequential(d3.interpolateOranges)
            
            var colorAg = d3.scaleQuantize()
				.range(["#ccece6", "#66c2a4", "#41ae76", "#238b45", "#005824"]);
            //Colors derived from ColorBrewer, by Cynthia Brewer, and included in
            //https://github.com/d3/d3-scale-chromatic

            /*var color = d3//.scaleLinear()
                        .scalePow().exponent(2)
                        .range(["rgb(186,228,179)","rgb(0,109,44)"])*/
            
			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
            
                
            //Load in agriculture and population data
            d3.csv("data.csv", function(data) {

                //Set input domain for color scale
                colorAg.domain([
                    d3.min(data, function(d) { return d.productivity; }), 
                    d3.max(data, function(d) { return d.productivity; })
                ]);

               /* colorPop.domain([
                    d3.min(data, function(d) { return d.population; }), 
                    d3.max(data, function(d) { return d.population; })
                ]);*/

                //Load in GeoJSON data
                d3.json("us-states.json", function(json) {

                    //Merge the ag. data and GeoJSON
                    //Loop through once for each ag. data value
                    for (var i = 0; i < data.length; i++) {

                        //Grab state name
                        var dataState = data[i].state;

                        //Grab data value, and convert from string to float
                        var productivity = parseFloat(data[i].productivity);
                        var population = parseFloat(data[i].population);

                        //Find the corresponding state inside the GeoJSON
                        for (var j = 0; j < json.features.length; j++) {

                            var jsonState = json.features[j].properties.name;

                            if (dataState == jsonState) {

                                //Copy the data value into the JSON
                                json.features[j].properties.productivity = productivity;
                                json.features[j].properties.population = population;

                                //Stop looking through the JSON
                                break;

                            }
                        }		
                    }
                    
                    console.log(json)
                    
                    //Bind data and create one path per GeoJSON feature
                    svg.selectAll("path")
                       .data(json.features)
                       .enter()
                       .append("path")
                       .attr("d", path).attr("stroke","#fff")
                       .style("fill", function(d) {
                            //Get data value
                            var value = d.properties.productivity;

                            if (value) {
                                //If value exists…
                                return colorAg(value);
                            } else {
                                //If value is undefined…
                                return "#ccc";
                            }
                       });
                });

            });


            // Button Interactivity
            var togData = false;
             
            d3.select(".toggleData")
                .on("click", function(){
                    // Determine if current line is visible
                    togData=!togData;
                    console.log(togData);

                    if (togData == true){
                        svg.selectAll("path")
                            .transition().duration(800)
                            .style("fill", function(d) {
                                var value = d.properties.population;

                                if (value) {
                                    //If value exists…
                                    console.log(colorPop(value))
                                    console.log((value))
                                    return colorPop(value);
                                } else {
                                    //If value is undefined…
                                    return "#ccc";
                                } 
                         });
                    
                        d3.select("body")
                            .transition().duration(800)
                            .style("background-color","#381616");
                        
                        d3.select(".toggleData")
                            .transition().duration(800)
                            .style("background-color","#823232");
                        
                        d3.select("h1")
                            .transition().duration(800)
                            .text("United States Population, 2016");
                        
                    }
                
                    if (togData == false){
                        svg.selectAll("path")
                            .transition().duration(800)
                            .style("fill", function(d) {
                                var value = d.properties.productivity;

                                if (value) {
                                    //If value exists…
                                    
                                    
                                    return colorAg(value);
                                } else {
                                    //If value is undefined…
                                    return "#ccc";
                                } 
                         });
                    
                        d3.select("body")
                            .transition().duration(800)
                            .style("background-color","#163818");
                        
                        d3.select(".toggleData")
                            .transition().duration(800)
                            .style("background-color","#28682d");
                        
                        d3.select("h1")
                            .transition().duration(800)
                            .text("United States Agricultural Producitivity, 2016");
                        
                    }


                 });

        </script>
	</body>
</html>
